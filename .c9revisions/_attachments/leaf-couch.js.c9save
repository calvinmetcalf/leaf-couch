{"ts":1352899433855,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var db,rdb, dbPath= document.location.protocol+\"//\"+document.location.host+\"/\"+document.location.pathname.split(\"/\")[1];\nPouch(\"idb://leafcouch\",function(e1,db1){\n    if(!e1){\n        db=db1;\n        Pouch(dbPath,function(e2,db2){\n             if(!e2){\n                rdb=db2;\n                db.replicate.to(rdb,{continuous:true});\n            }\n        });\n    }\n});\nvar m= L.map('map').setView([39.40, -96.42], 4),\n\tmq=L.tileLayer(\"http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpeg\", {attribution:'Tiles Courtesy of <a href=\"http://www.mapquest.com/\">MapQuest</a> &mdash; Map data &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors', subdomains:'1234'}).addTo(m),\n\th = new L.Hash(m),\n\td = new L.Control.Draw().addTo(m),\n\tdrawnStuff = L.geoJson(\"\",{pointToLayer:pointToLayer,onEachFeature:popUp}).addTo(m),\n\tallStuff = L.geoJson.ajax(document.location.protocol+\"//\"+document.location.host+\"/\"+document.location.pathname.split(\"/\")[1]+\"/\"+document.location.pathname.split(\"/\")[2]+\"/\"+document.location.pathname.split(\"/\")[3]+\"/_spatial/_list/geojson/all?bbox=\"+m.getBounds().toBBoxString(),{pointToLayer:pointToLayer,onEachFeature:popUp});\n\tm.on('drawn', function (e) {\n\t\t\tdoStuff(e.feature);\n\t\t});\n\t\t\nfunction redoJson(){\n\t\tallStuff.clearLayers();\n\t\tallStuff.addUrl(document.location.protocol+\"//\"+document.location.host+\"/\"+document.location.pathname.split(\"/\")[1]+\"/\"+document.location.pathname.split(\"/\")[2]+\"/\"+document.location.pathname.split(\"/\")[3]+\"/_spatial/_list/geojson/all?bbox=\"+m.getBounds().toBBoxString());\n\t\t};\n\t\t\nm.on(\"moveend\", redoJson);\n\nvar baseMaps = {\n    \"Map Quest\": mq\n    }, overlayMaps = {\n\t\"Drawn Layers\":drawnStuff,\n\t\"All Layers\":allStuff\n\t},lc=L.control.layers(baseMaps, overlayMaps).addTo(m);\n\nfunction doStuff(data){\n\tdb.post(data,function(e,r){\n\t\tif(!e){\n\t\t\tdata.properties._id = r.id;\n\t\t\tdata.properties._rev = r.rev;\n\t\t\tdrawnStuff.addData(data);\n\t\t\t}\n\t});\n}\n\nfunction pointToLayer(f,l){\n\tif(f.properties.radius){\n\t\treturn L.circle(l, f.properties.radius);\n\t}else{\n\t\treturn L.marker(l);\n\t}\n}\nfunction popUp(f,l){\n    var out = [];\n    if (f.properties){\n        for(key in f.properties){\n        \tif(\"_\"!==key.slice(0,1)){\n            \tout.push(key+\": \"+f.properties[key]);\n        \t}\n        }\n        l.bindPopup(out.join(\"<br />\"));\n    }\n}\n\n//allStuff.on(\"click\",function(e){\n//var doc = e.layer.feature;\n//var props = doc.properties;\n//});\n"]],"start1":0,"start2":0,"length1":0,"length2":2429}]],"length":2429}
{"contributors":[],"silentsave":false,"ts":1352900077110,"patch":[[{"diffs":[[0,"\t\t\tdata."],[-1,"properties."],[0,"_id = r."]],"start1":1838,"start2":1838,"length1":27,"length2":16},{"diffs":[[0,"\t\t\tdata."],[-1,"properties."],[0,"_rev = r"]],"start1":1858,"start2":1858,"length1":27,"length2":16}]],"length":2407,"saved":false}
{"ts":1352900338584,"patch":[[{"diffs":[[0,"s){\n"],[-1,"        \tif(\"_\"!==key.slice(0,1)){\n"],[0,"    "]],"start1":2146,"start2":2146,"length1":43,"length2":8},{"diffs":[[0,"]);\n"],[-1,"        \t}\n"],[0,"    "]],"start1":2197,"start2":2197,"length1":19,"length2":8}]],"length":2361,"saved":false}
{"ts":1352901983470,"patch":[[{"diffs":[[0,"        "],[1,"/*"],[0,"Pouch(db"]],"start1":192,"start2":192,"length1":16,"length2":18},{"diffs":[[0,"     });"],[1,"*/"],[0,"\n    }\n}"]],"start1":353,"start2":353,"length1":16,"length2":18},{"diffs":[[0,"addTo(m)"],[1,";//"],[0,",\n\t"],[1,"//"],[0,"allStuff"]],"start1":849,"start2":849,"length1":19,"length2":24},{"diffs":[[0,"\t\t};\n\t\t\n"],[1,"//"],[0,"m.on(\"mo"]],"start1":1580,"start2":1580,"length1":16,"length2":18}]],"length":2372,"saved":false}
{"ts":1352902022149,"patch":[[{"diffs":[[0,"awnStuff"],[1,"//"],[0,",\n\t"],[1,"//"],[0,"\"All Lay"]],"start1":1696,"start2":1696,"length1":19,"length2":23}]],"length":2376,"saved":false}
{"ts":1352903451312,"patch":[[{"diffs":[[0,"db=db1;\n"],[1,"        db.changes({continuous:true,onChange:docChange,include_docs:true},docChange);\n"],[0,"        "]],"start1":184,"start2":184,"length1":16,"length2":102},{"diffs":[[0,"data"],[-1,",function(e,r){\n\t\tif(!e){\n\t\t\tdata._id = r.id;\n\t\t\tdata._rev = r.rev;\n\t\t\tdrawnStuff.addData(data);\n\t\t\t}\n\t}"],[0,");\n}"]],"start1":1909,"start2":1909,"length1":112,"length2":8},{"diffs":[[0,"    }\n}\n"],[1,"function docChange(c){\nvar doc = c.doc;    \nif(!doc._deleted){\ndrawnStuff.addData(doc);\n}\n}"],[0,"\n//allSt"]],"start1":2249,"start2":2249,"length1":16,"length2":107}]],"length":2449,"saved":false}
{"ts":1352903909050,"patch":[[{"diffs":[[0,"(doc);\n}"],[-1,"\n"],[1,"else if(doc._deleted){\n    delId(drawnStuff,doc._id);\n}\n}\nfunction delId(layer,id){\nlayer.eachLayer(function(f){\nif(f.feature._id===id){\nlayer.removeLayer(f);\n}\n})"],[0,"}\n//allS"]],"start1":2338,"start2":2338,"length1":17,"length2":179}]],"length":2611,"saved":false}
